
<ng-container *ngIf="isPublicPage">
  <main class="layout-container">
    <app-public-navbar [appSettings]="appSettings"></app-public-navbar>
    <router-outlet></router-outlet>
    <app-footer></app-footer>
  </main>
</ng-container>

<ng-container *ngIf="!isPublicPage">
<mat-sidenav-container class="layout-container">
  <!-- Sidebar -->
  <mat-sidenav #drawer mode="side" opened class="sidebar">
    <!-- Sidebar Header -->
    <div class="sidebar-header">
      <div class="logo-container gradient-primary">
        <img *ngIf="appSettings?.logo_url" [src]="appSettings.logo_url" alt="Company Logo" class="logo" />
        <mat-icon *ngIf="!appSettings?.logo_url" class="logo-icon">pets</mat-icon>
      </div>
      <div>
        <h2>{{ appSettings?.company_name || 'PawClean Pro' }}</h2>
        <p class="subtitle">Professional Pet Waste Management</p>
      </div>
    </div>

    <!-- Sidebar Navigation -->
    <mat-nav-list>
      
      <!-- Main Menu -->
      <div *ngIf="navigationItems.length > 0">
        <p class="group-label">Main Menu</p>
        <a mat-list-item *ngFor="let item of navigationItems" [routerLink]="item.url" [ngClass]="{'active': currentPath === item.url}">
          <mat-icon>{{ item.icon }}</mat-icon>
          <span>{{ item.title }}</span>
        </a>
      </div>

      <!-- Portals -->
      <div *ngIf="portalItems.length > 0">
        <p class="group-label">Portals & Comms</p>
        <a mat-list-item *ngFor="let item of portalItems" [routerLink]="item.url" [ngClass]="{'active': currentPath === item.url}">
          <mat-icon>{{ item.icon }}</mat-icon>
          <span>{{ item.title }}</span>
        </a>
      </div>

      <!-- Admin -->
      <div *ngIf="adminItems.length > 0">
        <p class="group-label">Administration</p>
        <a mat-list-item *ngFor="let item of adminItems" [routerLink]="item.url" [ngClass]="{'active': currentPath === item.url}">
          <mat-icon>{{ item.icon }}</mat-icon>
          <span>{{ item.title }}</span>
        </a>
      </div>
    </mat-nav-list>

    <!-- Sidebar Footer -->
    <div class="sidebar-footer">
      <button mat-button [matMenuTriggerFor]="accountMenu" class="account-btn">
        <div class="avatar">{{ currentAccount?.full_name?.[0] || 'U' }}</div>
        <div class="account-info">
          <p>{{ currentAccount?.full_name || 'Guest' }}</p>
          <p class="role">{{ currentAccount?.role || 'Guest' }}</p>
        </div>
        <mat-icon>expand_more</mat-icon>
      </button>

      <mat-menu #accountMenu="matMenu">
        <button mat-menu-item [routerLink]=""> <!-- createPageUrl('Settings') -->
          <mat-icon>settings</mat-icon> Settings
        </button>
        <button mat-menu-item [routerLink]=""> <!-- createPageUrl('Notifications') -->
          <mat-icon>notifications</mat-icon> Notifications
          <span *ngIf="unreadCount > 0" matBadge="{{ unreadCount }}" matBadgeColor="warn"></span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="handleLogout()" class="logout">
          <mat-icon>logout</mat-icon> Logout
        </button>
      </mat-menu>
    </div>
  </mat-sidenav>

  <!-- Main Content -->
  <mat-sidenav-content>
    <!-- Mobile Header -->
    <mat-toolbar class="mobile-header">
      <button mat-icon-button (click)="drawer.toggle()">
        <mat-icon>menu</mat-icon>
      </button>
      <span>{{ appSettings?.company_name || 'PawClean Pro' }}</span>
      <button mat-icon-button [routerLink]="" class="notification-btn"> <!-- createPageUrl('Notifications') -->
        <mat-icon>notifications</mat-icon>
        <span *ngIf="unreadCount > 0" matBadge="{{ unreadCount }}" matBadgeColor="warn"></span>
      </button>
    </mat-toolbar>

    <!-- Page Content -->
    <div class="page-content">
      <router-outlet></router-outlet>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
</ng-container>