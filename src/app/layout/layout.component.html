<mat-sidenav-container class="app-container">
  <!-- Sidebar -->
  <mat-sidenav #drawer mode="side" opened class="sidebar">
    <!-- Sidebar Header -->
    <div class="sidebar-header">
      <div class="logo-container">
        <img *ngIf="appSettings?.logo_url" [src]="appSettings.logo_url" alt="Company Logo" class="logo" />
        <div *ngIf="!appSettings?.logo_url" class="logo-placeholder">
          <lucide-icon name="dog"></lucide-icon>
        </div>
        <div>
          <h2>{{ appSettings?.company_name || 'PawClean Pro' }}</h2>
          <p class="subtitle">Professional Pet Waste Management</p>
        </div>
      </div>
    </div>

    <!-- Sidebar Navigation -->
    <mat-nav-list>
      <!-- Main Menu -->
      <div *ngIf="navigationItems.length > 0">
        <p class="group-label">Main Menu</p>
        <ng-container *ngFor="let item of navigationItems">
          <a mat-list-item [routerLink]="item.url" [ngClass]="{'active': currentPath === item.url}">
            <lucide-icon [name]="item.icon"></lucide-icon>
            <span>{{ item.title }}</span>
          </a>
        </ng-container>
      </div>

      <!-- Portals -->
      <div *ngIf="portalItems.length > 0">
        <p class="group-label">Portals & Comms</p>
        <ng-container *ngFor="let item of portalItems">
          <a mat-list-item [routerLink]="item.url" [ngClass]="{'active': currentPath === item.url}">
            <lucide-icon [name]="item.icon"></lucide-icon>
            <span>{{ item.title }}</span>
          </a>
        </ng-container>
      </div>

      <!-- Admin -->
      <div *ngIf="adminItems.length > 0">
        <p class="group-label">Administration</p>
        <ng-container *ngFor="let item of adminItems">
          <a mat-list-item [routerLink]="item.url" [ngClass]="{'active': currentPath === item.url}">
            <lucide-icon [name]="item.icon"></lucide-icon>
            <span>{{ item.title }}</span>
          </a>
        </ng-container>
      </div>
    </mat-nav-list>

    <!-- Sidebar Footer -->
    <div class="sidebar-footer">
      <button mat-button [matMenuTriggerFor]="accountMenu" class="account-btn">
        <div class="avatar">{{ currentAccount?.full_name?.[0] || 'U' }}</div>
        <div class="account-info">
          <p>{{ currentAccount?.full_name || 'Guest' }}</p>
          <p class="role">{{ currentAccount?.role || 'Admin' }}</p>
        </div>
        <lucide-icon name="chevron-down"></lucide-icon>
      </button>

      <mat-menu #accountMenu="matMenu">
        <button mat-menu-item [routerLink]="createPageUrl('Settings')">
          <lucide-icon name="settings"></lucide-icon> Settings
        </button>
        <button mat-menu-item [routerLink]="createPageUrl('Notifications')">
          <lucide-icon name="bell"></lucide-icon> Notifications
          <span *ngIf="unreadCount > 0" matBadge="{{ unreadCount }}" matBadgeColor="warn"></span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="handleLogout()" class="logout">
          <lucide-icon name="log-out"></lucide-icon> Logout
        </button>
      </mat-menu>
    </div>
  </mat-sidenav>

  <!-- Main Content -->
  <mat-sidenav-content>
    <!-- Mobile Header -->
    <mat-toolbar class="mobile-header">
      <button mat-icon-button (click)="drawer.toggle()">
        <lucide-icon name="menu"></lucide-icon>
      </button>
      <span>{{ appSettings?.company_name || 'PawClean Pro' }}</span>
      <button mat-icon-button [routerLink]="createPageUrl('Notifications')" class="notification-btn">
        <lucide-icon name="bell"></lucide-icon>
        <span *ngIf="unreadCount > 0" matBadge="{{ unreadCount }}" matBadgeColor="warn"></span>
      </button>
    </mat-toolbar>

    <!-- Page Content -->
    <div class="page-content">
      <router-outlet></router-outlet>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>