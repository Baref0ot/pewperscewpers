<!-- Theme is driven by CSS vars set from appSettings in TS -->
<div class="bg-white text-gray-800" *ngIf="!isLoading; else loadingTpl">

  <!-- Hero -->
  <section class="hero-banner">
    <div class="container">
      <h1 class="headline">A Clean Yard is a Happy Yard.</h1>
      <p class="subhead">
        We provide reliable, professional pet waste removal services so you can enjoy your yard, worry-free.
      </p>

      <div class="cta-row">
        <button mat-raised-button class="mat-flat-button btn-action"
                [routerLink]="[]" fragment="quote">
          Get Started Today
        </button>

        <button mat-stroked-button class="mat-outlined-button btn-outline-primary"
                [routerLink]="[]" fragment="services">
          View Services
        </button>
      </div>
    </div>
  </section>

  <!-- Features -->
  <section class="section features section section--muted">
    <div class="container">
      <div class="features_grid">
        <div class="feature">
          <lucide-icon name="Shield" class="feature_icon text-primary"></lucide-icon>
          <h3 class="feature_title">Reliable Service</h3>
          <p class="feature_text">Our team is always on time, ensuring your yard is consistently clean.</p>
        </div>

        <div class="feature">
          <lucide-icon name="Sparkles" class="feature_icon text-primary"></lucide-icon>
          <h3 class="feature-title">Satisfaction Guaranteed</h3>
          <p class="feature-text">We stand by our work. If you're not happy, we'll make it right.</p>
        </div>

        <div class="feature">
          <lucide-icon name="MessageCircle" class="feature_icon text-primary"></lucide-icon>
          <h3 class="feature-title">Easy Communication</h3>
          <p class="feature-text">Manage your service and communicate with us easily through your portal.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Services -->
  <section id="services" class="section services">
    <div class="container">
      <div class="text-center mb-12">
        <h2 class="section_title">Our Services</h2>
        <p class="section_subtitle">Tailored to fit your needs.</p>
      </div>

      <div class="services_grid">
        <mat-card class="add mat-card service-card"
                  *ngFor="let service of services;">
          <div class="aspect-video">
            <img [src]="service.image_url ? service.image_url : 'https://images.unsplash.com/photo-1517849845537-4d257902454a?q=80&w=400&auto=format&fit=crop'"
                 [alt]="service.name" loading="lazy" />
          </div>

          <mat-card-content class="service-card_body">
            <h3 class="service-card_title">{{ service.name }}</h3>
            <p class="service-card_text">{{ service.description }}</p>
            <div class="service-card_price">
              ${{ service.price | number:'1.2-2' }}
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </section>

  <!-- Quote -->
  <section id="quote" class="section quote section--muted">
    <div class="container">
      <div class="text-center mb-12">
        <h2 class="section_title">Get Your Free Quote</h2>
        <p class="section_subtitle">Instant, easy, and no obligation.</p>
      </div>

      <div class="twocol">

        <!-- Form -->
        <form [formGroup]="form" (ngSubmit)="onSeeJourney()" class="quote_form">

          <!-- Num Dogs -->   
           <div class="quote_label">
            <mat-label>How many dogs do you have?</mat-label>
            <mat-form-field appearance="outline">
              <mat-select formControlName="numDogs">
                <mat-option *ngFor="let n of [1,2,3,4,5,6,7,8]" [value]="n">
                  {{ n }} dog{{ n > 1 ? 's' : '' }}
                </mat-option>
              </mat-select>
            </mat-form-field> 
         </div>

          <!-- How Often -->
          <div class="quote_label">
            <mat-label>How often?</mat-label>
            <mat-form-field appearance="outline">
              <mat-select formControlName="frequency">
                <mat-option value="one-time">One-Time Cleanup</mat-option>
                <mat-option value="weekly">Weekly Service</mat-option>
                <mat-option value="bi-weekly">Every 2 Weeks</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          

          <!-- Addon Services -->
          <div class="form-field" *ngIf="addonServices.length > 0">
            <mat-label class="quote_label">Additional Services</mat-label>
            <div class="addon-list">
              <div class="addon-item" [class.is-selected]="selectedServiceIds.has(svc.id)" *ngFor="let svc of addonServices;" (click)="toggleAddon(svc.id)">
                <div class="addon-row">
                  <mat-checkbox
                    [checked]="selectedServiceIds.has(svc.id)"
                    (change)="toggleAddon(svc.id);">
                  </mat-checkbox>

                  <div class="addon-info">
                    <label class="addon-item_name">{{ svc.name }}</label>
                    <p class="addon-item_desc">{{ svc.description }}</p>
                    <p class="addon-item_price">+${{ svc.price | number:'1.2-2' }}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Email -->
          <div class="quote_label">
            <mat-label for="email">Your Email Address</mat-label>
            <mat-form-field appearance="outline">
              <input matInput id="email" type="email" placeholder="you@example.com" formControlName="email" required />
            </mat-form-field>
          </div>

        </form>

        <!-- Summary -->
        <div class="quote_summary">
          <h3 class="summary_title">Your Estimated Quote</h3>

          <ng-container *ngIf="quote; else noQuote">
            <p class="summary_amount">
              ${{ quote.amount | number:'1.2-2' }}
            </p>
            <p class="summary_period">{{ quote.period }}</p>

            <div class="summary_breakdown">
              <h4 class="breakdown-title">Quote Breakdown:</h4>
              <div class="rows">
                <div class="row">
                  <span>Base Price:</span>
                  <span>${{ quote.breakdown.base | number:'1.2-2' }}</span>
                </div>
                <div class="row">
                  <span>{{ quote.breakdown.numDogs }} Dog{{ quote.breakdown.numDogs! > 1 ? 's' : '' }}:</span>
                  <span>${{ quote.breakdown.dogs | number:'1.2-2' }}</span>
                </div>
                <div class="row" *ngIf="quote.breakdown.services! > 0">
                  <span>Add-on Services:</span>
                  <span>${{ quote.breakdown.services | number:'1.2-2' }}</span>
                </div>
                <div class=" row row--total">
                  <span>Total:</span>
                  <span>${{ quote.amount | number:'1.2-2' }}</span>
                </div>
              </div>
            </div>

            <button mat-flat-button class="summary_cta btn-primary"
                    (click)="onSeeJourney()" [disabled]="isSubmitting">
              {{ isSubmitting ? 'Preparing...' : 'See Your Service Day Story!' }}
            </button>
          </ng-container>

          <ng-template #noQuote>
            <p class="text-center text-gray-500">Fill out the form to see your price.</p>
          </ng-template>
        </div> <!-- quote summary -->

      </div> <!-- twocol -->
    </div>
  </section>

  <!-- Testimonials -->
  <section id="reviews" class="section reviews" *ngIf="reviews.length > 0">
    <div class="container">
      <div class="section_title">
        <h2 class="h2">What Our Customers Say</h2>
      </div>

      <div class="reviews_grid">
        <mat-card class="mat-card review-card" *ngFor="let r of reviews;">
          <mat-card-content class="review-card_body">
            <div class="review-card_stars">
              <mat-icon *ngFor="let _ of stars; let i = index" [ngClass]="i < r.rating ? 'star-on' : 'star-off'">
                star
              </mat-icon>
            </div>

            <p class="review-card_text">"{{ r.comment }}"</p>

            <div class="review-card_person">
              <img class="avatar"
                   [src]=" r.image_url || ('https://ui-avatars.com/api/?name=' + r.customer_name)"
                   [alt]="r.customer_name" />
              <span class="name">{{ r.customer_name }}</span>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </section>

</div>

<ng-template #loadingTpl>
  <div class="container py-16 text-center">Loadingâ€¦</div>
</ng-template>
